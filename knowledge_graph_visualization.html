<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Knowledge Graph Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e2e8f0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #2d3748;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4a5568;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #a0aec0;
        }

        .header a {
            color: #667eea;
            text-decoration: none;
        }

        .header a:hover {
            text-decoration: underline;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1a202c;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            color: #a0aec0;
            font-weight: 600;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 2px solid #4a5568;
            border-radius: 6px;
            background: #2d3748;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .control-group button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }

        .control-group button:hover {
            transform: translateY(-2px);
        }

        /* Graph Container */
        .graph-container {
            position: relative;
            width: 100%;
            height: 800px;
            background: #1a202c;
            border-radius: 10px;
            border: 2px solid #4a5568;
            overflow: hidden;
        }

        /* Node Styles */
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node-circle {
            stroke-width: 2px;
            transition: all 0.3s ease;
        }

        .node-circle.framework {
            fill: #667eea;
            stroke: #764ba2;
        }

        .node-circle.standard {
            fill: #48bb78;
            stroke: #38a169;
        }

        .node-circle.component {
            fill: #ed8936;
            stroke: #dd6b20;
        }

        .node:hover .node-circle {
            stroke-width: 4px;
            filter: brightness(1.2);
        }

        .node-label {
            font-size: 12px;
            fill: #e2e8f0;
            pointer-events: none;
            text-anchor: middle;
            font-weight: 600;
        }

        /* Link Styles */
        .link {
            stroke: #4a5568;
            stroke-width: 2px;
            opacity: 0.6;
            fill: none;
        }

        .link.supports {
            stroke: #48bb78;
        }

        .link.buildsTowards {
            stroke: #667eea;
        }

        .link.relatesTo {
            stroke: #ed8936;
        }

        .link:hover {
            stroke-width: 4px;
            opacity: 1;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(26, 32, 44, 0.95);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
            color: #e2e8f0;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .tooltip-content {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #a0aec0;
        }

        .tooltip-label {
            font-weight: 600;
            color: #e2e8f0;
            margin-top: 8px;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            padding: 20px;
            background: #1a202c;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .legend-color.framework { background: #667eea; }
        .legend-color.standard { background: #48bb78; }
        .legend-color.component { background: #ed8936; }

        .legend-text {
            color: #a0aec0;
            font-size: 0.9rem;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #a0aec0;
        }

        /* Learner Profile Section */
        .learner-profile-section {
            margin-top: 50px;
            padding-top: 40px;
            border-top: 3px solid #4a5568;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .section-header p {
            font-size: 1.1rem;
            color: #a0aec0;
        }

        .learner-profile-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .profile-card {
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 25px;
        }

        .profile-card h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a5568;
        }

        .profile-input {
            margin-bottom: 20px;
        }

        .profile-input label {
            display: block;
            color: #a0aec0;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .profile-input input,
        .profile-input select {
            width: 100%;
            padding: 10px;
            border: 2px solid #4a5568;
            border-radius: 6px;
            background: #2d3748;
            color: #e2e8f0;
            font-size: 0.95rem;
        }

        .profile-input input:focus,
        .profile-input select:focus {
            outline: none;
            border-color: #667eea;
        }

        .mastery-map {
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 25px;
        }

        .mastery-map h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a5568;
        }

        .mastery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .mastery-item {
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .mastery-item:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .mastery-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .mastery-item-title {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.95rem;
        }

        .mastery-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .mastery-badge.mastered {
            background: #48bb78;
            color: white;
        }

        .mastery-badge.proficient {
            background: #667eea;
            color: white;
        }

        .mastery-badge.developing {
            background: #ed8936;
            color: white;
        }

        .mastery-badge.novice {
            background: #e53e3e;
            color: white;
        }

        .mastery-progress {
            width: 100%;
            height: 8px;
            background: #1a202c;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .mastery-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .mastery-progress-fill.mastered {
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
        }

        .mastery-progress-fill.proficient {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .mastery-progress-fill.developing {
            background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%);
        }

        .mastery-progress-fill.novice {
            background: linear-gradient(90deg, #e53e3e 0%, #c53030 100%);
        }

        /* Early Signal Maps */
        .signal-maps {
            margin-top: 40px;
        }

        .signal-map-card {
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .signal-map-card h3 {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .signal-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: #2d3748;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .signal-indicator.strong {
            border-left-color: #48bb78;
        }

        .signal-indicator.moderate {
            border-left-color: #ed8936;
        }

        .signal-indicator.weak {
            border-left-color: #e53e3e;
        }

        .signal-content {
            flex: 1;
        }

        .signal-title {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 4px;
        }

        .signal-description {
            font-size: 0.85rem;
            color: #a0aec0;
        }

        .signal-strength {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .signal-strength.strong {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
        }

        .signal-strength.moderate {
            background: rgba(237, 137, 54, 0.2);
            color: #ed8936;
        }

        .signal-strength.weak {
            background: rgba(229, 62, 62, 0.2);
            color: #e53e3e;
        }

        /* Knowledge Graph Integration */
        .integration-view {
            margin-top: 40px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 25px;
        }

        .integration-view h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .mastery-pathway {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a202c;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .pathway-node {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
        }

        .pathway-node.mastered {
            background: #48bb78;
        }

        .pathway-node.proficient {
            background: #667eea;
        }

        .pathway-node.developing {
            background: #ed8936;
        }

        .pathway-node.novice {
            background: #e53e3e;
        }

        .pathway-arrow {
            color: #667eea;
            font-size: 1.5rem;
        }

        .pathway-label {
            flex: 1;
            color: #e2e8f0;
            font-weight: 600;
        }

        /* Info Panel */
        .info-panel {
            margin-top: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .info-panel h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-panel p {
            color: #a0aec0;
            line-height: 1.7;
        }

        .info-panel a {
            color: #667eea;
            text-decoration: none;
        }

        .info-panel a:hover {
            text-decoration: underline;
        }

        @media (max-width: 1200px) {
            .learner-profile-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Educational Knowledge Graph</h1>
            <p>Interactive visualization of Learning Commons Knowledge Graph</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">
                Based on <a href="https://github.com/learning-commons-org/knowledge-graph" target="_blank">learning-commons-org/knowledge-graph</a>
            </p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label>Entity Type:</label>
                <select id="entityFilter">
                    <option value="all">All Entities</option>
                    <option value="framework">Standards Framework</option>
                    <option value="standard">Standards Framework Item</option>
                    <option value="component">Learning Component</option>
                </select>
            </div>
            <div class="control-group">
                <label>Subject:</label>
                <select id="subjectFilter">
                    <option value="all">All Subjects</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="English Language Arts">English Language Arts</option>
                    <option value="Science">Science</option>
                </select>
            </div>
            <div class="control-group">
                <label>Relationship:</label>
                <select id="relationshipFilter">
                    <option value="all">All Relationships</option>
                    <option value="supports">Supports</option>
                    <option value="buildsTowards">Builds Towards</option>
                    <option value="relatesTo">Relates To</option>
                </select>
            </div>
            <div class="control-group">
                <button onclick="resetGraph()">Reset View</button>
                <button onclick="downloadData()">Download Sample</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="statFrameworks">0</div>
                <div class="stat-label">Standards Frameworks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statStandards">0</div>
                <div class="stat-label">Standards Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statComponents">0</div>
                <div class="stat-label">Learning Components</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statRelationships">0</div>
                <div class="stat-label">Relationships</div>
            </div>
        </div>

        <!-- Graph Container -->
        <div class="graph-container">
            <svg id="graph"></svg>
            <div class="tooltip" id="tooltip">
                <div class="tooltip-title" id="tooltipTitle"></div>
                <div class="tooltip-content" id="tooltipContent"></div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color framework"></div>
                <span class="legend-text">Standards Framework</span>
            </div>
            <div class="legend-item">
                <div class="legend-color standard"></div>
                <span class="legend-text">Standards Framework Item</span>
            </div>
            <div class="legend-item">
                <div class="legend-color component"></div>
                <span class="legend-text">Learning Component</span>
            </div>
            <div class="legend-item">
                <div style="width: 30px; height: 3px; background: #48bb78;"></div>
                <span class="legend-text">Supports</span>
            </div>
            <div class="legend-item">
                <div style="width: 30px; height: 3px; background: #667eea;"></div>
                <span class="legend-text">Builds Towards</span>
            </div>
            <div class="legend-item">
                <div style="width: 30px; height: 3px; background: #ed8936;"></div>
                <span class="legend-text">Relates To</span>
            </div>
        </div>

        <!-- Initial Hypotheses Section -->
        <div class="hypotheses-section" style="margin-top: 50px; padding-top: 40px; border-top: 3px solid #4a5568;">
            <div class="section-header">
                <h2>Initial Hypotheses for Knowledge Testing</h2>
                <p>Foundational assumptions that guide mastery assessment and early signal detection</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 30px;">
                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #667eea; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">1. Granular Component Mastery</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Testing at the granular learning component level provides more accurate and actionable mastery signals than testing at the standard level alone.
                    </p>
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #667eea;">
                        <strong style="color: #667eea;">Implication:</strong> 
                        <span style="color: #a0aec0;">By mapping mastery to individual learning components, we can identify specific skill gaps and provide targeted interventions.</span>
                    </div>
                </div>

                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #48bb78; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #48bb78; font-size: 1.3rem; margin-bottom: 15px;">2. Prerequisite Relationships</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Mastery of prerequisite components (indicated by "buildsTowards" relationships) is predictive of success in subsequent standards.
                    </p>
                    <div style="background: rgba(72, 187, 120, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #48bb78;">
                        <strong style="color: #48bb78;">Implication:</strong> 
                        <span style="color: #a0aec0;">Early signals can predict readiness for advanced concepts by analyzing prerequisite mastery patterns.</span>
                    </div>
                </div>

                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #ed8936; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #ed8936; font-size: 1.3rem; margin-bottom: 15px;">3. Multi-Modal Assessment</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Combining multiple assessment attempts and modalities provides more reliable mastery signals than single-point assessments.
                    </p>
                    <div style="background: rgba(237, 137, 54, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ed8936;">
                        <strong style="color: #ed8936;">Implication:</strong> 
                        <span style="color: #a0aec0;">Track attempts, time between attempts, and performance trends to identify true mastery vs. temporary performance.</span>
                    </div>
                </div>

                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #764ba2; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #764ba2; font-size: 1.3rem; margin-bottom: 15px;">4. Early Signal Detection</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Patterns in mastery distribution (novice clusters, developing gaps) provide early signals for intervention needs before performance issues become critical.
                    </p>
                    <div style="background: rgba(118, 75, 162, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #764ba2;">
                        <strong style="color: #764ba2;">Implication:</strong> 
                        <span style="color: #a0aec0;">Proactive identification of learning gaps enables timely intervention and prevents cascading knowledge gaps.</span>
                    </div>
                </div>

                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #4299e1; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #4299e1; font-size: 1.3rem; margin-bottom: 15px;">5. Knowledge Graph Alignment</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Mastery aligned with knowledge graph relationships (supports, buildsTowards) indicates coherent understanding vs. isolated skill acquisition.
                    </p>
                    <div style="background: rgba(66, 153, 225, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #4299e1;">
                        <strong style="color: #4299e1;">Implication:</strong> 
                        <span style="color: #a0aec0;">Learners with mastery aligned to graph structure show deeper conceptual understanding and better transfer.</span>
                    </div>
                </div>

                <div class="hypothesis-card" style="background: #1a202c; border: 2px solid #e53e3e; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #e53e3e; font-size: 1.3rem; margin-bottom: 15px;">6. Threshold Mastery Levels</h3>
                    <p style="color: #a0aec0; line-height: 1.7; margin-bottom: 15px;">
                        <strong>Hypothesis:</strong> Mastery thresholds (Novice <50%, Developing 50-70%, Proficient 70-90%, Mastered ≥90%) provide meaningful distinctions for instructional decisions.
                    </p>
                    <div style="background: rgba(229, 62, 62, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #e53e3e;">
                        <strong style="color: #e53e3e;">Implication:</strong> 
                        <span style="color: #a0aec0;">Different mastery levels require different instructional strategies: remediation, practice, extension, or advanced content.</span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 40px; padding: 25px; background: rgba(102, 126, 234, 0.1); border-radius: 12px; border: 2px solid #667eea;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Testing Methodology</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h4 style="color: #e2e8f0; margin-bottom: 10px;">Assessment Approach</h4>
                        <ul style="color: #a0aec0; line-height: 1.8; margin-left: 20px;">
                            <li>Component-level granular testing</li>
                            <li>Multiple assessment attempts</li>
                            <li>Performance trend analysis</li>
                            <li>Time-based mastery validation</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #e2e8f0; margin-bottom: 10px;">Signal Detection</h4>
                        <ul style="color: #a0aec0; line-height: 1.8; margin-left: 20px;">
                            <li>Pattern recognition in mastery distribution</li>
                            <li>Prerequisite gap identification</li>
                            <li>Progression readiness analysis</li>
                            <li>Knowledge graph alignment scoring</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #e2e8f0; margin-bottom: 10px;">Predictive Indicators</h4>
                        <ul style="color: #a0aec0; line-height: 1.8; margin-left: 20px;">
                            <li>Mastery rate acceleration/deceleration</li>
                            <li>Component clustering patterns</li>
                            <li>Relationship strength indicators</li>
                            <li>Early intervention triggers</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Learner Profile Section -->
        <div class="learner-profile-section">
            <div class="section-header">
                <h2>Ideal Learner Profile & Mastery Mapping</h2>
                <p>Build comprehensive learner profiles that complement the knowledge graph to test mastery and identify early signals</p>
            </div>

            <div class="learner-profile-container">
                <!-- Learner Profile Card -->
                <div class="profile-card">
                    <h3>Learner Profile</h3>
                    <div class="profile-input">
                        <label>Learner Name</label>
                        <input type="text" id="learnerName" placeholder="Enter learner name" value="Sample Learner">
                    </div>
                    <div class="profile-input">
                        <label>Grade Level</label>
                        <select id="learnerGrade">
                            <option value="6">Grade 6</option>
                            <option value="7">Grade 7</option>
                            <option value="8">Grade 8</option>
                            <option value="9">Grade 9</option>
                        </select>
                    </div>
                    <div class="profile-input">
                        <label>Subject Focus</label>
                        <select id="learnerSubject">
                            <option value="Mathematics">Mathematics</option>
                            <option value="English Language Arts">English Language Arts</option>
                            <option value="Science">Science</option>
                        </select>
                    </div>
                    <div class="profile-input">
                        <label>Learning Style</label>
                        <select id="learningStyle">
                            <option value="visual">Visual</option>
                            <option value="auditory">Auditory</option>
                            <option value="kinesthetic">Kinesthetic</option>
                            <option value="reading">Reading/Writing</option>
                        </select>
                    </div>
                    <button onclick="updateLearnerProfile()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px;">
                        Update Profile
                    </button>
                </div>

                <!-- Mastery Map -->
                <div class="mastery-map">
                    <h3>Mastery Map</h3>
                    <div class="mastery-grid" id="masteryGrid">
                        <!-- Mastery items will be dynamically inserted -->
                    </div>
                </div>
            </div>

            <!-- Early Signal Maps -->
            <div class="signal-maps">
                <h3 style="color: #e2e8f0; font-size: 1.5rem; margin-bottom: 20px;">Early Signal Maps</h3>
                <div class="signal-map-card">
                    <h3>Knowledge Graph Alignment Signals</h3>
                    <div id="signalIndicators">
                        <!-- Signal indicators will be dynamically inserted -->
                    </div>
                </div>

                <div class="signal-map-card">
                    <h3>Learning Progression Signals</h3>
                    <div id="progressionSignals">
                        <!-- Progression signals will be dynamically inserted -->
                    </div>
                </div>
            </div>

            <!-- Knowledge Graph Integration View -->
            <div class="integration-view">
                <h3>Knowledge Graph → Learner Mastery Integration</h3>
                <p style="color: #a0aec0; margin-bottom: 20px;">
                    This view shows how learner mastery maps to the knowledge graph structure, enabling early identification of learning gaps and strengths.
                </p>
                <div id="masteryPathways">
                    <!-- Mastery pathways will be dynamically inserted -->
                </div>
            </div>
        </div>

        <!-- Info Panel -->
        <div class="info-panel">
            <h3>About the Knowledge Graph</h3>
            <p>
                This visualization represents the <strong>Learning Commons Knowledge Graph</strong>, which connects 
                state academic standards, curricula, and learning science data. The graph includes:
            </p>
            <ul style="margin-left: 20px; margin-top: 10px; color: #a0aec0; line-height: 1.8;">
                <li><strong>Standards Framework:</strong> Educational standards frameworks (e.g., Common Core State Standards)</li>
                <li><strong>Standards Framework Item:</strong> Individual standards and learning objectives within frameworks</li>
                <li><strong>Learning Component:</strong> Granular, precise representations of individual skills or concepts</li>
                <li><strong>Relationships:</strong> Connections between entities (supports, buildsTowards, relatesTo)</li>
            </ul>
            <p style="margin-top: 15px;">
                <strong>Use Cases:</strong> Standards alignment, instructional planning, state standards comparison, and curriculum alignment.
                For more information, visit <a href="https://docs.learningcommons.org/knowledge-graph/" target="_blank">the Knowledge Graph documentation</a>.
            </p>
        </div>
    </div>

    <script>
        // Sample data structure based on Learning Commons Knowledge Graph
        const sampleData = {
            frameworks: [
                { id: 'f1', name: 'Common Core State Standards', subject: 'Mathematics', jurisdiction: 'Multi-State' },
                { id: 'f2', name: 'Common Core State Standards', subject: 'English Language Arts', jurisdiction: 'Multi-State' },
                { id: 'f3', name: 'Texas Essential Knowledge and Skills', subject: 'Mathematics', jurisdiction: 'Texas' }
            ],
            standards: [
                { id: 's1', code: '6.NS.1', description: 'Interpret and compute quotients of fractions', framework: 'f1', grade: '6', subject: 'Mathematics' },
                { id: 's2', code: '6.NS.2', description: 'Fluently divide multi-digit numbers', framework: 'f1', grade: '6', subject: 'Mathematics' },
                { id: 's3', code: '7.NS.1', description: 'Apply and extend previous understandings of addition', framework: 'f1', grade: '7', subject: 'Mathematics' },
                { id: 's4', code: '6.RL.1', description: 'Cite textual evidence', framework: 'f2', grade: '6', subject: 'English Language Arts' },
                { id: 's5', code: '6.RL.2', description: 'Determine a theme or central idea', framework: 'f2', grade: '6', subject: 'English Language Arts' }
            ],
            components: [
                { id: 'c1', description: 'Fraction division computation', subject: 'Mathematics' },
                { id: 'c2', description: 'Long division algorithm', subject: 'Mathematics' },
                { id: 'c3', description: 'Integer addition', subject: 'Mathematics' },
                { id: 'c4', description: 'Text evidence identification', subject: 'English Language Arts' },
                { id: 'c5', description: 'Theme analysis', subject: 'English Language Arts' }
            ],
            relationships: [
                { source: 'f1', target: 's1', type: 'contains' },
                { source: 'f1', target: 's2', type: 'contains' },
                { source: 'f1', target: 's3', type: 'contains' },
                { source: 'f2', target: 's4', type: 'contains' },
                { source: 'f2', target: 's5', type: 'contains' },
                { source: 's1', target: 'c1', type: 'supports' },
                { source: 's2', target: 'c2', type: 'supports' },
                { source: 's3', target: 'c3', type: 'supports' },
                { source: 's4', target: 'c4', type: 'supports' },
                { source: 's5', target: 'c5', type: 'supports' },
                { source: 's2', target: 's1', type: 'buildsTowards' },
                { source: 's3', target: 's2', type: 'buildsTowards' },
                { source: 's5', target: 's4', type: 'buildsTowards' },
                { source: 'c1', target: 'c2', type: 'relatesTo' }
            ]
        };

        // Initialize graph
        const width = document.querySelector('.graph-container').offsetWidth;
        const height = 800;
        const svg = d3.select('#graph')
            .attr('width', width)
            .attr('height', height);

        let simulation, nodes, links;

        // Create tooltip
        const tooltip = d3.select('#tooltip');

        function initGraph(data = sampleData) {
            // Clear existing graph
            svg.selectAll('*').remove();

            // Prepare nodes
            const nodeMap = new Map();
            
            data.frameworks.forEach(f => {
                nodeMap.set(f.id, { ...f, type: 'framework', label: f.name });
            });
            
            data.standards.forEach(s => {
                nodeMap.set(s.id, { ...s, type: 'standard', label: s.code });
            });
            
            data.components.forEach(c => {
                nodeMap.set(c.id, { ...c, type: 'component', label: c.description.substring(0, 30) });
            });

            nodes = Array.from(nodeMap.values());
            
            // Prepare links
            links = data.relationships.map(r => ({
                source: r.source,
                target: r.target,
                type: r.type
            }));

            // Update stats
            document.getElementById('statFrameworks').textContent = data.frameworks.length;
            document.getElementById('statStandards').textContent = data.standards.length;
            document.getElementById('statComponents').textContent = data.components.length;
            document.getElementById('statRelationships').textContent = links.length;

            // Create simulation
            simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(30));

            // Draw links
            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .enter()
                .append('line')
                .attr('class', d => `link ${d.type}`)
                .attr('stroke-width', 2);

            // Draw nodes
            const node = svg.append('g')
                .selectAll('g')
                .data(nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append('circle')
                .attr('class', d => `node-circle ${d.type}`)
                .attr('r', d => d.type === 'framework' ? 25 : d.type === 'standard' ? 18 : 15);

            node.append('text')
                .attr('class', 'node-label')
                .attr('dy', d => d.type === 'framework' ? 40 : 30)
                .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label);

            // Add interactions
            node.on('mouseover', function(event, d) {
                showTooltip(event, d);
            })
            .on('mousemove', function(event) {
                tooltip
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseout', function() {
                hideTooltip();
            });

            // Update positions
            simulation.on('tick', () => {
                link
                    .attr('x1', d => {
                        const source = typeof d.source === 'string' ? nodes.find(n => n.id === d.source) : d.source;
                        return source ? source.x : 0;
                    })
                    .attr('y1', d => {
                        const source = typeof d.source === 'string' ? nodes.find(n => n.id === d.source) : d.source;
                        return source ? source.y : 0;
                    })
                    .attr('x2', d => {
                        const target = typeof d.target === 'string' ? nodes.find(n => n.id === d.target) : d.target;
                        return target ? target.x : 0;
                    })
                    .attr('y2', d => {
                        const target = typeof d.target === 'string' ? nodes.find(n => n.id === d.target) : d.target;
                        return target ? target.y : 0;
                    });

                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });
        }

        function showTooltip(event, d) {
            const title = d.type === 'framework' ? d.name : 
                         d.type === 'standard' ? d.code : 
                         d.description;
            
            let content = '';
            if (d.type === 'framework') {
                content = `<div class="tooltip-label">Subject:</div> ${d.subject || 'N/A'}<br>
                          <div class="tooltip-label">Jurisdiction:</div> ${d.jurisdiction || 'N/A'}`;
            } else if (d.type === 'standard') {
                content = `<div class="tooltip-label">Description:</div> ${d.description || 'N/A'}<br>
                          <div class="tooltip-label">Grade:</div> ${d.grade || 'N/A'}<br>
                          <div class="tooltip-label">Subject:</div> ${d.subject || 'N/A'}`;
            } else {
                content = `<div class="tooltip-label">Subject:</div> ${d.subject || 'N/A'}`;
            }

            document.getElementById('tooltipTitle').textContent = title;
            document.getElementById('tooltipContent').innerHTML = content;
            tooltip.classed('visible', true);
        }

        function hideTooltip() {
            tooltip.classed('visible', false);
        }

        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        function resetGraph() {
            initGraph(sampleData);
        }

        function downloadData() {
            const dataStr = JSON.stringify(sampleData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'knowledge_graph_sample.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Filter handlers
        document.getElementById('entityFilter').addEventListener('change', function() {
            // Filter implementation would go here
            console.log('Filter changed:', this.value);
        });

        // Learner Profile Data
        let learnerProfile = {
            name: 'Sample Learner',
            grade: '6',
            subject: 'Mathematics',
            learningStyle: 'visual',
            mastery: {}
        };

        // Mastery levels mapped to knowledge graph components
        const masteryData = {
            'c1': { level: 'proficient', score: 75, attempts: 3, lastAttempt: '2025-01-15' },
            'c2': { level: 'mastered', score: 92, attempts: 2, lastAttempt: '2025-01-14' },
            'c3': { level: 'developing', score: 55, attempts: 4, lastAttempt: '2025-01-16' },
            'c4': { level: 'novice', score: 35, attempts: 1, lastAttempt: '2025-01-10' },
            'c5': { level: 'proficient', score: 78, attempts: 2, lastAttempt: '2025-01-13' }
        };

        // Initialize mastery display
        function initMasteryMap() {
            const grid = document.getElementById('masteryGrid');
            grid.innerHTML = '';

            sampleData.components.forEach(component => {
                const mastery = masteryData[component.id] || { level: 'novice', score: 0, attempts: 0 };
                const masteryLevels = {
                    mastered: { label: 'Mastered', threshold: 90 },
                    proficient: { label: 'Proficient', threshold: 70 },
                    developing: { label: 'Developing', threshold: 50 },
                    novice: { label: 'Novice', threshold: 0 }
                };

                const item = document.createElement('div');
                item.className = 'mastery-item';
                item.innerHTML = `
                    <div class="mastery-item-header">
                        <div class="mastery-item-title">${component.description}</div>
                        <div class="mastery-badge ${mastery.level}">${masteryLevels[mastery.level].label}</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #a0aec0; margin-bottom: 8px;">
                        Score: ${mastery.score}% | Attempts: ${mastery.attempts}
                    </div>
                    <div class="mastery-progress">
                        <div class="mastery-progress-fill ${mastery.level}" style="width: ${mastery.score}%"></div>
                    </div>
                `;
                grid.appendChild(item);
            });
        }

        // Generate early signals
        function generateEarlySignals() {
            const signals = [];
            
            // Analyze mastery patterns
            const masteredCount = Object.values(masteryData).filter(m => m.level === 'mastered').length;
            const noviceCount = Object.values(masteryData).filter(m => m.level === 'novice').length;
            
            if (masteredCount > Object.keys(masteryData).length * 0.5) {
                signals.push({
                    type: 'strong',
                    icon: '',
                    title: 'Strong Mastery Foundation',
                    description: 'Learner demonstrates mastery in over 50% of assessed components. Ready for advanced concepts.',
                    strength: 'strong'
                });
            }

            if (noviceCount > 0) {
                signals.push({
                    type: 'weak',
                    icon: '',
                    title: 'Early Intervention Needed',
                    description: `${noviceCount} learning component(s) at novice level. Consider targeted support and practice.`,
                    strength: 'weak'
                });
            }

            // Check for progression gaps
            const developingComponents = Object.entries(masteryData).filter(([id, m]) => m.level === 'developing');
            if (developingComponents.length > 2) {
                signals.push({
                    type: 'moderate',
                    icon: '',
                    title: 'Multiple Skills in Development',
                    description: `${developingComponents.length} components in development phase. Monitor closely for progress.`,
                    strength: 'moderate'
                });
            }

            // Check alignment with knowledge graph
            const standardsCovered = new Set();
            sampleData.relationships.forEach(rel => {
                if (rel.type === 'supports' && masteryData[rel.target]) {
                    standardsCovered.add(rel.source);
                }
            });

            if (standardsCovered.size > 0) {
                signals.push({
                    type: 'strong',
                    icon: '',
                    title: 'Knowledge Graph Alignment',
                    description: `Learner mastery aligns with ${standardsCovered.size} standard(s) in the knowledge graph.`,
                    strength: 'strong'
                });
            }

            return signals;
        }

        // Display early signals
        function displayEarlySignals() {
            const indicators = document.getElementById('signalIndicators');
            const signals = generateEarlySignals();
            
            indicators.innerHTML = '';
            signals.forEach(signal => {
                const indicator = document.createElement('div');
                indicator.className = `signal-indicator ${signal.strength}`;
                indicator.innerHTML = `
                    <div class="signal-content">
                        <div class="signal-title">${signal.title}</div>
                        <div class="signal-description">${signal.description}</div>
                    </div>
                    <div class="signal-strength ${signal.strength}">${signal.strength.toUpperCase()}</div>
                `;
                indicators.appendChild(indicator);
            });
        }

        // Generate progression signals
        function generateProgressionSignals() {
            const progression = [];
            
            // Find standards that build toward current focus
            sampleData.relationships.forEach(rel => {
                if (rel.type === 'buildsTowards') {
                    const sourceStandard = sampleData.standards.find(s => s.id === rel.source);
                    const targetStandard = sampleData.standards.find(s => s.id === rel.target);
                    
                    if (sourceStandard && targetStandard) {
                        // Check if learner has mastered prerequisite
                        const sourceComponents = sampleData.relationships
                            .filter(r => r.source === sourceStandard.id && r.type === 'supports')
                            .map(r => r.target);
                        
                        const sourceMastery = sourceComponents.map(cid => masteryData[cid])
                            .filter(m => m && m.level === 'mastered').length;
                        
                        if (sourceMastery > 0 && sourceMastery < sourceComponents.length) {
                            progression.push({
                                type: 'moderate',
                                icon: '',
                                title: `Prerequisite Progress: ${sourceStandard.code}`,
                                description: `${sourceMastery}/${sourceComponents.length} prerequisite components mastered for ${targetStandard.code}`,
                                strength: sourceMastery === sourceComponents.length ? 'strong' : 'moderate'
                            });
                        }
                    }
                }
            });

            return progression;
        }

        // Display progression signals
        function displayProgressionSignals() {
            const container = document.getElementById('progressionSignals');
            const signals = generateProgressionSignals();
            
            container.innerHTML = '';
            if (signals.length === 0) {
                container.innerHTML = '<p style="color: #a0aec0; text-align: center; padding: 20px;">No progression signals at this time. Continue building mastery to unlock learning pathways.</p>';
                return;
            }

            signals.forEach(signal => {
                const indicator = document.createElement('div');
                indicator.className = `signal-indicator ${signal.strength}`;
                indicator.innerHTML = `
                    <div class="signal-content">
                        <div class="signal-title">${signal.title}</div>
                        <div class="signal-description">${signal.description}</div>
                    </div>
                    <div class="signal-strength ${signal.strength}">${signal.strength.toUpperCase()}</div>
                `;
                container.appendChild(indicator);
            });
        }

        // Generate mastery pathways
        function generateMasteryPathways() {
            const pathways = [];
            
            // Find learning pathways through the knowledge graph
            sampleData.relationships.forEach(rel => {
                if (rel.type === 'buildsTowards') {
                    const sourceStandard = sampleData.standards.find(s => s.id === rel.source);
                    const targetStandard = sampleData.standards.find(s => s.id === rel.target);
                    
                    if (sourceStandard && targetStandard) {
                        // Get components for each standard
                        const sourceComponents = sampleData.relationships
                            .filter(r => r.source === sourceStandard.id && r.type === 'supports')
                            .map(r => r.target);
                        
                        const targetComponents = sampleData.relationships
                            .filter(r => r.source === targetStandard.id && r.type === 'supports')
                            .map(r => r.target);
                        
                        // Calculate average mastery
                        const sourceMastery = sourceComponents.map(cid => masteryData[cid]?.score || 0)
                            .reduce((a, b) => a + b, 0) / sourceComponents.length || 0;
                        
                        const targetMastery = targetComponents.map(cid => masteryData[cid]?.score || 0)
                            .reduce((a, b) => a + b, 0) / targetComponents.length || 0;
                        
                        const sourceLevel = sourceMastery >= 90 ? 'mastered' : 
                                           sourceMastery >= 70 ? 'proficient' :
                                           sourceMastery >= 50 ? 'developing' : 'novice';
                        
                        const targetLevel = targetMastery >= 90 ? 'mastered' : 
                                          targetMastery >= 70 ? 'proficient' :
                                          targetMastery >= 50 ? 'developing' : 'novice';
                        
                        pathways.push({
                            source: sourceStandard.code,
                            target: targetStandard.code,
                            sourceLevel: sourceLevel,
                            targetLevel: targetLevel,
                            description: `${sourceStandard.description} → ${targetStandard.description}`
                        });
                    }
                }
            });

            return pathways;
        }

        // Display mastery pathways
        function displayMasteryPathways() {
            const container = document.getElementById('masteryPathways');
            const pathways = generateMasteryPathways();
            
            container.innerHTML = '';
            pathways.forEach(pathway => {
                const pathwayEl = document.createElement('div');
                pathwayEl.className = 'mastery-pathway';
                pathwayEl.innerHTML = `
                    <div class="pathway-node ${pathway.sourceLevel}">${pathway.source}</div>
                    <div class="pathway-arrow">→</div>
                    <div class="pathway-node ${pathway.targetLevel}">${pathway.target}</div>
                    <div class="pathway-label">${pathway.description}</div>
                `;
                container.appendChild(pathwayEl);
            });
        }

        // Update learner profile
        function updateLearnerProfile() {
            learnerProfile.name = document.getElementById('learnerName').value;
            learnerProfile.grade = document.getElementById('learnerGrade').value;
            learnerProfile.subject = document.getElementById('learnerSubject').value;
            learnerProfile.learningStyle = document.getElementById('learningStyle').value;
            
            // Refresh all displays
            initMasteryMap();
            displayEarlySignals();
            displayProgressionSignals();
            displayMasteryPathways();
            
            // Update graph to highlight relevant components
            highlightRelevantComponents();
        }

        // Highlight relevant components in graph
        function highlightRelevantComponents() {
            // This would update the graph visualization to highlight mastered/developing components
            console.log('Updating graph highlights for:', learnerProfile);
        }

        // Initialize on load
        window.addEventListener('load', function() {
            initGraph();
            initMasteryMap();
            displayEarlySignals();
            displayProgressionSignals();
            displayMasteryPathways();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const newWidth = document.querySelector('.graph-container').offsetWidth;
            svg.attr('width', newWidth);
            if (simulation) {
                simulation.force('center', d3.forceCenter(newWidth / 2, height / 2));
                simulation.restart();
            }
        });
    </script>
</body>
</html>

